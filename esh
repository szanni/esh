#!/bin/sh

usage () {
  printf "Usage: %s: [-s value] [-e value] file\n" $0
  exit 2
}

stag="{{"
etag="}}"
while getopts s:e: name
do
  case $name in
    s)  stag="$OPTARG";;
    e)  etag="$OPTARG";;
    ?)  usage;;
  esac
done
shift $(($OPTIND - 1))

if [ "$#" -ne 1 ]; then
  usage
fi

if [ ! -f "$1" ]; then
  echo "File not found: $1"
  exit 2
fi

{ echo -n "#!/bin/sh -e"; echo -n "$etag"; cat "$1"; echo -n "$stag"; } | sed \
  -e "s|${stag}=|${stag}echo -n |g" \
  -e "s|${stag}|\n${stag}\n)\"\n|g" \
  -e "s|${etag}|\necho -n \"\$(cat<<'${stag}'\n|g"
